define(["../../node_modules/@polymer/polymer/polymer-element.js","../../node_modules/@polymer/iron-ajax/iron-ajax.js","../../node_modules/@polymer/paper-card/paper-card.js","../../node_modules/@polymer/paper-button/paper-button.js","../../node_modules/@polymer/paper-input/paper-input.js","../../node_modules/@polymer/paper-input/paper-textarea.js","../../node_modules/@polymer/paper-dialog/paper-dialog.js"],function(_polymerElement,_ironAjax,_paperCard,_paperButton,_paperInput,_paperTextarea,_paperDialog){"use strict";function _templateObject_93e4e4e0b7a111e9be3d79e35e3a387f(){var data=babelHelpers.taggedTemplateLiteral(["\n    <style>\n\n\t.postdiv{\n\t    background-color:#4f5b62;\n\t    padding:15px;\n\t    margin-top:10px; \n\n\t    }\n\n\t.nav span{\n\t\tfont-weight:lighter;\n\t    color:#ff4081;\n\t    font-size:30px;\n      text-transform:uppercase;\n\t\t}    \n\n\t.nav{\n\t\tdisplay: flex;\n\t\tmargin: 1em;\n\t}    \n\n\t.alignright{\n\t\tmargin-left: auto;\n\t}\n\n  #sobtn\n  {\n    background-color:red;\n    color:white;\n  }\n\n  #sbtn{\n    background-color:green;\n    color:white;\n  }\n  #addpost\n  {\n    background-color:#ff4081;\n    color:white;\n  }\n\n  #dialog{\n    border-radius:5px;\n    width:100vh;\n  }\n  .buttons{\n    display: flex;\n\n\n  }\n  #login{\n    border-radius:5px;\n\n  }\n  .postdiv{\n\n\n  }\n\n\n\n    </style>\n\n<div class=\"nav\">\n<span>Tracoph-Blog</span>\n\n<div class=\"alignright\"><paper-button on-tap=\"addForm\"  id=\"addpost\" >Add post</paper-button></div>\n<div><paper-button on-tap=\"signIntoggle\" id=\"sbtn\">Sign In</paper-button></div>\n<div><paper-button on-tap=\"signOut\"  id=\"sobtn\">Sign Out</paper-button></div>\n\n\n</div>\n\n\n<div id=\"blogList\">\n\n</div>\n\n\n<!--Modal Add post form-->\n\n<paper-dialog id=\"dialog\" modal>\n\n <form id=\"form\">\n <paper-input label=\"Title\" id=\"title\"></paper-input>\n <paper-input label=\"Author name\"id=\"aname\" ></paper-input>\n <paper-textarea label=\"Content goes here\" id=\"content\"></paper-textarea>\n\n  <div class=\"buttons\">\n<!--<input type=\"file\" accept=\"image/*\" alt=\"add image\" id=\"image\"></input> -->\n\n    <div class=\"alignright\"><paper-button dialog-confirm style=\"background-color: #263238; color: white;\" >close</paper-button>\n    </div>\n    <div>\n    <paper-button style=\"background-color:#ff4081;color: white;\" on-tap=\"subMit\">Submit</paper-button>\n   </div>\n    \n  </div>\n</form>\n</paper-dialog>\n\n<!--Modal Sign in-->\n\n<paper-dialog id=\"login\" modal>\n\n <form id=\"form\">\n <paper-input label=\"User Name\" id=\"uname\"></paper-input>\n <paper-input label=\"Password\" id=\"pwd\" type=\"password\" ></paper-input>\n\n  <div class=\"buttons\">\n   <div class=\"alignright\"> <paper-button dialog-confirm style=\"background-color: #263238; color: white;\" >close</paper-button>\n    </div>\n   <div> <paper-button style=\"background-color:#ff4081;color: white;\" on-tap=\"readUser\">Login</paper-button>\n </div>\n    \n  </div>\n</form>\n</paper-dialog>\n\n\n<!--Modal update post form-->\n\n<paper-dialog id=\"updatediag\" modal>\n\n <form id=\"form\">\n <paper-input label=\"Title\" id=\"uptitle\"></paper-input>\n <paper-input label=\"Author name\"id=\"upname\" ></paper-input>\n <paper-textarea label=\"Content goes here\" id=\"upcontent\"></paper-textarea>\n\n  <div class=\"buttons\">\n  <div class=\"alignright\">  <paper-button dialog-confirm style=\"background-color: #263238; color: white;\" >close</paper-button>\n    </div>\n   <div> <paper-button style=\"background-color:#ff4081;color: white;\" on-tap=\"updatePost\">update</paper-button>\n </div>\n    \n  </div>\n</form>\n</paper-dialog>\n\n\n\n\n\n\n    "]);_templateObject_93e4e4e0b7a111e9be3d79e35e3a387f=function _templateObject_93e4e4e0b7a111e9be3d79e35e3a387f(){return data};return data}var blog=/*#__PURE__*/function(_PolymerElement){babelHelpers.inherits(blog,_PolymerElement);function blog(){babelHelpers.classCallCheck(this,blog);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(blog).apply(this,arguments))}babelHelpers.createClass(blog,[{key:"ready",value:function ready(){babelHelpers.get(babelHelpers.getPrototypeOf(blog.prototype),"ready",this).call(this);// checks for session details
var check=sessionStorage.values,f=sessionStorage.flag;//first load
if("undefined"===typeof f){var values={addpost:"none",sobtn:"none"};window.sessionStorage.values=JSON.stringify(values);var rvalue=JSON.parse(sessionStorage.values);this.$.addpost.style.display=rvalue.addpost;this.$.sobtn.style.display=rvalue.sobtn}//signed in
else if("1"===f){this.$.sbtn.style.display="none"}//signed out
else if("0"===f){var values={addpost:"none",sobtn:"none"};window.sessionStorage.values=JSON.stringify(values);var rvalue=JSON.parse(sessionStorage.values);this.$.addpost.style.display=rvalue.addpost;this.$.sobtn.style.display=rvalue.sobtn}this.addEventListener("load",this.fireRead())}//Display posts from firebase
},{key:"fireRead",value:function fireRead(){var _this=this;db.collection("blog").get().then(function(snapshot){snapshot.docs.forEach(function(doc){_this.renderData(doc)})})}},{key:"renderData",value:function renderData(doc){var bList=this.$.blogList,div=document.createElement("div"),title=document.createElement("h2"),author=document.createElement("span"),content=document.createElement("p"),time=document.createElement("p");div.setAttribute("docId",doc.id);div.setAttribute("class","postdiv");title.setAttribute("class","title");author.setAttribute("class","author");content.setAttribute("class","content");title.textContent=doc.data().title;author.textContent=doc.data().author;content.textContent=doc.data().content;time.textContent=doc.data().date;div.appendChild(title);div.appendChild(author);div.appendChild(content);div.appendChild(time);// delete element
var f=sessionStorage.flag,idc=doc.id;if("1"===f){var delbtn=document.createElement("paper-button");delbtn.innerHTML="delete";delbtn.setAttribute("id","delbtn");div.appendChild(delbtn);delbtn.onclick=function deletePost(){if(confirm("Are sure you want to delete this post?")){db.collection("blog").doc(idc).delete().then(function(){window.location.reload()}).catch(function(error){window.alert("Failed to delete post: ",error)})}};//update post
var updt=document.createElement("paper-button");updt.innerHTML="update";updt.setAttribute("id","upadtebtn");div.appendChild(updt);var diag=this.$.updatediag;updt.onclick=function updateToggle(){diag.toggle();pid=idc}}//endif
bList.appendChild(div)}},{key:"updatePost",value:function updatePost(){var upatedoc=db.collection("blog").doc(pid),title=this.$.uptitle.value,author=this.$.upname.value,content=this.$.upcontent.value,date=new Date().toString(),data={title:title,author:author,content:content,date:date},updatediag=this.$.updatediag;return upatedoc.update(data).then(function(){updatediag.close();window.location.reload()}).catch(function(error){// The document probably doesn't exist.
window.alert("Failed to update post: ",error)})}},{key:"addForm",value:function addForm(){this.$.dialog.toggle()}},{key:"subMit",value:function subMit(){var title=this.$.title.value,author=this.$.aname.value,content=this.$.content.value,date=new Date().toString();this.fireWrite(title,author,content,date)}},{key:"fireWrite",//push data into Firebase
value:function fireWrite(title,author,content,date){var data={title:title,author:author,content:content,date:date},dialog=this.$.dialog;db.collection("blog").add(data).then(function(){dialog.close();window.location.reload()}).catch(function(error){window.alert("Failed to post: ",error)})}},{key:"readUser",value:function readUser(){var _this2=this;db.collection("userdetail").get().then(function(snapshot){snapshot.docs.forEach(function(udat){_this2.signIn(udat)})})}},{key:"signIntoggle",value:function signIntoggle(){this.$.login.toggle()}},{key:"signIn",value:function signIn(udat){var user=udat.data().username,pass=udat.data().password,userinp=this.$.uname.value,pwdinp=this.$.pwd.value;if(user===userinp&&pass===pwdinp){this.$.login.close();var values={addpost:"block",sbtn:"none",sobtn:"block"};window.sessionStorage.values=JSON.stringify(values);var rvalue=JSON.parse(sessionStorage.values);this.$.addpost.style.display=rvalue.addpost;this.$.sbtn.style.display=rvalue.sbtn;this.$.sobtn.style.display=rvalue.sobtn;window.sessionStorage.flag=1;window.location.reload()}else{window.alert("Invalid Username / Password")}}},{key:"signOut",value:function signOut(){sessionStorage.flag=0;window.location.reload()}}],[{key:"template",get:function get(){return(0,_polymerElement.html)(_templateObject_93e4e4e0b7a111e9be3d79e35e3a387f())}}]);return blog}(_polymerElement.PolymerElement);window.customElements.define("tr-blog",blog)});